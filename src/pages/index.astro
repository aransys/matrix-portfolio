---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import Hero from '../components/Hero.astro';
import About from '../components/About.astro';
import Services from '../components/Services.astro';
import Projects from '../components/Projects.astro';
import Skills from '../components/Skills.astro';
import Contact from '../components/Contact.astro';
import ThemeSwitcher from '../components/ThemeSwitcher.astro';
import ScrollToTop from '../components/ScrollToTop.astro';
import ScrollIndicators from '../components/ScrollIndicators.astro';
---

<Layout title="Aurimas Ransys - Full Stack Developer">
  <div class="matrix-bg" id="matrix-bg"></div>
  
  <Navigation />
  <ScrollIndicators />
  <Hero />
  <About />
  <Services />
  <Projects />
  <Skills />
  <Contact />
  <ThemeSwitcher />
  <ScrollToTop />
  
  <script>
    // @ts-nocheck
    /**
     * @param {HTMLElement | null} element
     * @param {string} text
     * @param {number} [speed]
     */
    
    function createMatrixRain() {
      const container = document.getElementById('matrix-bg');
      if (!container) return;
      
      const columns = Math.floor(window.innerWidth / 20);
      const characters = '01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン';
      
      container.innerHTML = '';
      
      for (let i = 0; i < columns; i++) {
        const column = document.createElement('div');
        column.className = 'matrix-column';
        column.style.left = i * 20 + 'px';
        column.style.animationDuration = Math.random() * 3 + 2 + 's';
        column.style.animationDelay = Math.random() * 2 + 's';
        
        let text = '';
        for (let j = 0; j < 20; j++) {
          text += characters.charAt(Math.floor(Math.random() * characters.length)) + '<br>';
        }
        column.innerHTML = text;
        
        container.appendChild(column);
      }
    }
    
    
    
    
    function typeWriter(element, text, speed = 100) {
      if (!element) return;
      let i = 0;
      element.innerHTML = '';
      
      function type() {
        if (i < text.length) {
          if (element) {
            element.innerHTML += text.charAt(i);
          }
          i++;
          setTimeout(type, speed);
        }
      }
      type();
    }
    
    function handleScrollAnimations() {
      const elements = document.querySelectorAll('.fade-in');
      
      elements.forEach(element => {
        const elementTop = element.getBoundingClientRect().top;
        const elementVisible = 150;
        
        if (elementTop < window.innerHeight - elementVisible) {
          element.classList.add('visible');
        }
      });
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', (e) => {
        e.preventDefault();
        const href = anchor.getAttribute('href');
        if (href) {
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        }
      });
    });
    
    window.addEventListener('load', () => {
      createMatrixRain();
      handleScrollAnimations();
      
      const subtitle = document.querySelector('.hero-subtitle');
      if (subtitle) {
        typeWriter(subtitle, 'Full Stack Developer |');
      }
    });
    
    window.addEventListener('scroll', handleScrollAnimations);
    window.addEventListener('resize', () => {
      createMatrixRain();
    });
    
    // Replace native alerts with styled modal
    if (!window.__originalAlert) {
      // @ts-ignore
      window.__originalAlert = window.alert;
      window.alert = (message) => {
        showAlertModal(String(message ?? ''));
      };
    }
    
    // Easter egg: Terminal prompt click
    let terminalClickCount = 0;
    /** @type {number | undefined} */
    let terminalClickTimer;
    /** @type {number | undefined} */
    let easterEggResetTimer;
    const matrixQuotes = [
      "Wake up, Neo...",
      "Follow the white rabbit",
      "There is no spoon",
      "The Matrix has you",
      "Welcome to the real world",
      "What is the Matrix?",
      "Red pill or blue pill?",
      "Free your mind"
    ];
    
    const terminalPrompt = document.getElementById('terminal-prompt');
    if (terminalPrompt) {
      const originalText = terminalPrompt.textContent;
      
      terminalPrompt.addEventListener('click', () => {
        terminalClickCount++;
        clearTimeout(terminalClickTimer);
        
        if (terminalClickCount === 3) {
          const randomQuote = matrixQuotes[Math.floor(Math.random() * matrixQuotes.length)];
          terminalPrompt.textContent = `user@matrix:~$ ${randomQuote}`;
          terminalPrompt.classList.add('easter-egg');
          terminalClickCount = 0;
          
          // Auto-reset after 4 seconds (for touch devices)
          clearTimeout(easterEggResetTimer);
          easterEggResetTimer = window.setTimeout(() => {
            terminalPrompt.textContent = originalText;
            terminalPrompt.classList.remove('easter-egg');
          }, 4000);
        }
        
        terminalClickTimer = window.setTimeout(() => {
          terminalClickCount = 0;
        }, 1000);
      });
      
      // Instant reset on mouseleave (for desktop)
      terminalPrompt.addEventListener('mouseleave', () => {
        clearTimeout(easterEggResetTimer);
        terminalPrompt.textContent = originalText;
        terminalPrompt.classList.remove('easter-egg');
      });
    }
    
    // Easter egg: Konami code
    /** @type {string[]} */
    let konamiCode = [];
    const sequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
    
    document.addEventListener('keydown', (e) => {
      konamiCode.push(e.code);
      if (konamiCode.length > sequence.length) {
        konamiCode.shift();
      }
      
      if (konamiCode.join(',') === sequence.join(',')) {
        const body = document.body;
        const previousTheme = body.getAttribute('data-theme') || 'reloaded';
        body.setAttribute('data-theme', 'pink');
        showNeoModal(() => {
          body.setAttribute('data-theme', previousTheme);
        });
        konamiCode = [];
      }
    });
    
    function showAlertModal(message) {
      const existBackdrop = document.getElementById('neoBackdrop');
      const existStatus = document.getElementById('neoStatus');
      const backdrop = existBackdrop || document.createElement('div');
      const status = existStatus || document.createElement('div');
      
      if (!existBackdrop) {
        backdrop.id = 'neoBackdrop';
        backdrop.className = 'neo-backdrop';
        backdrop.setAttribute('aria-hidden', 'true');
        document.body.appendChild(backdrop);
      }
      if (!existStatus) {
        status.id = 'neoStatus';
        status.className = 'neo-status';
        status.setAttribute('role', 'alertdialog');
        status.setAttribute('aria-modal', 'true');
        status.setAttribute('aria-labelledby', 'neo-status-title');
        status.setAttribute('aria-live', 'assertive');
        document.body.appendChild(status);
      }
      status.innerHTML = `
        <div class="neo-scanlines" aria-hidden="true"></div>
        <div class="status-icon" aria-hidden="true">[ ! ]</div>
        <div class="status-title" id="neo-status-title">
          <span class="glitch" data-text="SYSTEM MESSAGE">SYSTEM MESSAGE</span>
        </div>
        <div class="status-subtitle">${message}</div>
        <div class="status-actions">
          <button class="btn blue" id="neoBlue">OK</button>
        </div>
      `;
      const blueBtn = document.getElementById('neoBlue');
      const close = () => {
        backdrop.classList.remove('show');
        status.classList.remove('show');
        backdrop.setAttribute('aria-hidden', 'true');
        status.setAttribute('aria-hidden', 'true');
        document.removeEventListener('keydown', escHandler);
        backdrop.removeEventListener('click', close);
      };
      const escHandler = (e) => { if (e.key === 'Escape') close(); };
      backdrop.classList.add('show');
      status.classList.add('show');
      backdrop.setAttribute('aria-hidden', 'false');
      status.setAttribute('aria-hidden', 'false');
      if (blueBtn) blueBtn.onclick = close;
      backdrop.addEventListener('click', close);
      document.addEventListener('keydown', escHandler);
    }

    function showNeoModal(onClose) {
      const existBackdrop = document.getElementById('neoBackdrop');
      const existStatus = document.getElementById('neoStatus');
      const backdrop = existBackdrop || document.createElement('div');
      const status = existStatus || document.createElement('div');
      
      if (!existBackdrop) {
        backdrop.id = 'neoBackdrop';
        backdrop.className = 'neo-backdrop';
        backdrop.setAttribute('aria-hidden', 'true');
        document.body.appendChild(backdrop);
      }
      
      if (!existStatus) {
        status.id = 'neoStatus';
        status.className = 'neo-status';
        status.setAttribute('role', 'alertdialog');
        status.setAttribute('aria-modal', 'true');
        status.setAttribute('aria-labelledby', 'neo-status-title');
        status.setAttribute('aria-live', 'assertive');
        status.innerHTML = `
          <div class="neo-scanlines" aria-hidden="true"></div>
          <div class="status-icon" aria-hidden="true">[ █ ]</div>
          <div class="status-title" id="neo-status-title">
            <span class="glitch" data-text="WELCOME, NEO">WELCOME, NEO</span>
          </div>
          <div class="status-subtitle">Take the <strong>red pill</strong> to see how deep the rabbit hole goes…</div>
          <div class="status-actions">
            <button class="btn red" id="neoRed">RED PILL</button>
            <button class="btn blue" id="neoBlue">BLUE PILL</button>
          </div>
        `;
        document.body.appendChild(status);
      }
      
      const redBtn = document.getElementById('neoRed');
      const blueBtn = document.getElementById('neoBlue');
      const close = () => {
        backdrop.classList.remove('show');
        status.classList.remove('show');
        backdrop.setAttribute('aria-hidden', 'true');
        status.setAttribute('aria-hidden', 'true');
        document.removeEventListener('keydown', escHandler);
        backdrop.removeEventListener('click', close);
        if (typeof onClose === 'function') onClose();
      };
      const escHandler = (e) => {
        if (e.key === 'Escape') close();
      };
      
      backdrop.classList.add('show');
      status.classList.add('show');
      backdrop.setAttribute('aria-hidden', 'false');
      status.setAttribute('aria-hidden', 'false');
      
      if (blueBtn) blueBtn.onclick = close;
      if (redBtn) redBtn.onclick = () => {
        status.style.boxShadow = '0 0 20px rgba(255,62,165,0.4), var(--glow)';
        setTimeout(close, 8000);
      };
      backdrop.addEventListener('click', close);
      document.addEventListener('keydown', escHandler);
      
      // Auto-dismiss after 10s fail-safe
      setTimeout(() => {
        if (status.classList.contains('show')) close();
      }, 10000);
    });
  </script>
</Layout>
